- Python 禁用 stdout 缓冲（print 输出延迟）

  ```bash
  python3 -u xxx
  
  -u     : force the stdout and stderr streams to be unbuffered;
           this option has no effect on stdin; also PYTHONUNBUFFERED=x
  ```

- <https://clay-wangzhi.com/cloudnative/troubleshooting/enable-service-links.html>

- <https://kubernetes.p2hp.com/docs/concepts/cluster-administration/system-metrics/>

K8s 指标

Kube-scheduler 指标暴露在 HTTP 端点 `/metrics/resources`

Kubelet 还会在 `/metrics/cadvisor`， `/metrics/resource` 和 `/metrics/probes` 端点中公开度量值。

- <https://www.cnblogs.com/cheyunhua/p/10097611.html> 指标强化

- 指标聚合示例：<https://support.huaweicloud.com/intl/zh-cn/bestpractice-cci2/cci_04_0018.html>

- <https://blog.csdn.net/MaueiceWei999/article/details/88387138> RX 和 TX 最大是 4096，当前值为 256 。队列越大丢包的可能越小，但数据延迟会增加。

<https://docs.amd.com/r/en-US/ug1586-onload-user/EF_RXQ_SIZE>

Combined = 8，说明当前 NIC 网卡会使用 8 个进程处理网络数据。

更改 eth0 网卡 Combined 的值：

```
ethtool -L eth0 combined 8
```

查看队列

```bash
ethtool -x
```

- 丢包排查：<https://www.cnblogs.com/x_wukong/p/9305039.html>

- 存储进阶学习：<https://arthurchiao.art/blog/storage-advanced-notes-1-zh/>

- Mount 挂载和 systemd

```bash
实际上挂载单元的文件名和挂载点是关联的，挂载点路径转换为去掉以一个斜线，所有斜线转成横线
例如它这个/proc/sys/fs/binfmt_misc转成proc-sys-fs-binfmt_misc.mount，注意，mount 单元不能从模版实例化而来， 也不能通过创建软连接的方法给同一个 mount 单元赋予多个别名
```

<https://zhangguanzhang.github.io/2019/01/30/fstab/#>

- Horizon 进阶学习

<https://blog.51cto.com/sparkgo/5478585?cid=2629585&fid=2628825#2629585>

- pg_auto_failover PostgreSQL 高可用方案

<https://github.com/livingdocsIO/dockerfile-postgres>、<https://hub.docker.com/r/livingdocs/postgres>

备用服务器测试

| 测试场景             | 观察                                                         |
| :------------------- | :----------------------------------------------------------- |
| 终止 PostgreSQL 进程 | Pacemaker 将 PostgreSQL 进程恢复到运行状态。应用程序写入数据没有中断。 |
| 停止 PostgreSQL 进程 | Pacemaker 将 PostgreSQL 进程恢复到运行状态。应用程序写入数据没有中断。 |
| 重新启动服务器       | 备用服务器最初被标记为离线状态。服务器重新启动运行后，PostgreSQL 将由 Pacemaker 启动，并且服务器被标记为在线状态。如果启用了隔离，则不会将节点自动添加到集群中。应用程序写入数据没有中断。 |
| 停止 Pacemaker 进程  | 它还将停止 PostgreSQL 进程，并且服务器将被标记为离线状态。应用程序写入数据没有中断。 |

主服务器测试

| 测试场景             | 观察                                                         |
| -------------------- | ------------------------------------------------------------ |
| 终止 PostgreSQL 进程 | Pacemaker 将 PostgreSQL 进程恢复到运行状态。在阈值时间内恢复了主数据库，因此未触发选主。应用程序写入数据中断了大约 26 秒。 |
| 停止 PostgreSQL 进程 | Pacemaker 将 PostgreSQL 进程恢复到运行状态。在阈值时间内恢复了主数据库，因此未触发选主。应用程序写入数据中断了大约 26 秒。 |
| 重新启动服务器       | 在主服务器不可用的阈值时间后，Pacemaker 触发了选主。最符合条件的备用服务器被提升为新的主服务器。旧的主服务器重新启动运行后，它将被作为备用服务器添加回集群中。如果启用了隔离，则不会将节点自动添加到集群中。应用程序写入数据中断了大约 26 秒。 |
|                      |                                                              |

网络隔离测试

| 测试场景                                         | 观察                                                         |
| ------------------------------------------------ | ------------------------------------------------------------ |
| 将备用服务器与其他服务器之间的网络隔离           | Corosync 通信在备用服务器上被阻止了。服务器被标记为离线状态，并且 PostgreSQL 服务由于仲裁策略而关闭。应用程序写入数据没有出现中断。 |
| 将主服务器与其他服务器之间的网络隔离（脑裂场景） | Corosync 通信在主服务器上被阻止了。由于仲裁策略，PostgreSQL 服务已关闭，主服务器被标记为离线状态。在大范围的选区内选举了一个新的主服务器。应用程序写入数据出现了中断。 |

其他测试

| 测试场景                                                     | 观察                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 通过关闭所有备用服务器来退化集群。                           | 当所有备用服务器都宕机时，由于仲裁策略，主服务器上的 PostgreSQL 服务会停止。在此测试之后，当所有备用服务器都恢复运行后，会选择一个新的主服务器。应用程序写入数据出现了中断。 |
| 从主服务器开始，一个接一个地随机关闭所有服务器，然后同时将它们全部运行起来 | 所有服务器都启动并加入集群。选举了新的主服务器。应用程序写入数据出现了中断。 |

## TTL 和冷热温架构

- 使用 TTL（生存时间）管理数据 <https://clickhouse.com/docs/guides/developer/ttl>

定义磁盘

```xml
<clickhouse>
    <storage_configuration>
        <disks>
            <default>
            </default>
           <hot_disk>
              <path>./hot/</path>
           </hot_disk>
           <warm_disk>
              <path>./warm/</path>
           </warm_disk>
           <cold_disk>
              <path>./cold/</path>
           </cold_disk>
        </disks>
        <policies>
            <default>
                <volumes>
                    <default>
                        <disk>default</disk>
                    </default>
                    <hot_volume>
                        <disk>hot_disk</disk>
                    </hot_volume>
                    <warm_volume>
                        <disk>warm_disk</disk>
                    </warm_volume>
                    <cold_volume>
                        <disk>cold_disk</disk>
                    </cold_volume>
                </volumes>
            </default>
        </policies>
    </storage_configuration>
</clickhouse>
```

## 调试

查看不同数据的盘

```sql
SELECT volume_name,
    disks
FROM system.storage_policies
```

查看分区

```sql
SELECT
    name,
    disk_name
FROM system.parts
WHERE (table = 'snapshot') AND (active = 1)

SELECT
    disk_name,
    count(*)
FROM system.parts
WHERE (table = 'snapshot') AND (active = 1) GROUP BY disk_name

```

查看 MovePart 事件

```sql
SELECT
    event_time,
    database,
    table,
    event_type,
    partition ,
    disk_name,
    partition_id,
    part_name, 
    duration_ms,
    error 
FROM system.part_log
WHERE 
event_type ='MovePart' 
ORDER BY event_time DESC LIMIT 10

SELECT
    *
FROM system.part_log
WHERE 
event_type ='MovePart' 
ORDER BY event_time DESC LIMIT 10

SELECT
    *
FROM system.moves LIMIT 1
```


## 内置凭证类型

凭证类型可分为以下几类：

- SSH：用于远程主机访问
- Vault：用于敏感数据加密
- Source Control：用于版本控制系统
- Network：用于网络设备
- Cloud：用于云服务提供商

参考文档：<https://blog.csdn.net/gitblog_00531/article/details/148377865>

## 自定义凭证类型

查看已有凭据类型的声明

```bash
awx credential_types  list  | jq '.results[0]'
```

### 输入定义（Inputs）

凭证类型的输入定义决定了该类型需要收集哪些信息：

```json
{
  "inputs": {
    "fields": [
      {
        "id": "host", 
        "label": "Red Hat Ansible Automation Platform",
        "type": "string",
        "help_text": "Red Hat Ansible Automation Platform base URL to authenticate with."
      },
      {
        "id": "username",
        "label": "Username",
        "type": "string",
        "help_text": "Red Hat Ansible Automation Platform username id to authenticate as."
      },
      {
        "id": "password",           // 字段唯一标识
        "label": "Password",        // 用户界面显示标签
        "type": "string",           // 字段类型（string/boolean）
        "secret": true              // 是否加密存储
        "multiline": false,         // 是否多行输入
        "default": "default_value"  // 默认值
      }
    ],
    "required": [ // 必填字段
      "host"
    ]
  }
}
```

其他：

- 支持字段级格式验证（如 SSH 私钥格式）
- 支持下拉选择框（通过 `choices` 参数）
- 可定义字段帮助文本（`help_text`）

### 注入器（Injectors）

注入器定义了凭证值如何应用到执行环境中：

```json
"injectors": {
  "env": {
      "API_TOKEN": "{{api_token}}"    // 注入到环境变量
  },
  "extra_vars": {                    // 注入为额外变量
      "auth_token": "{{api_token}}"
  },
  "file": {                         // 生成临时文件
      "template": "[auth]\ntoken={{api_token}}"
  }
}

```

例子：

```json
{
  "injectors": {
    "env": {
      "TOWER_HOST": "{{host}}",
      "TOWER_USERNAME": "{{username}}",
      "TOWER_PASSWORD": "{{password}}",
      "TOWER_VERIFY_SSL": "{{verify_ssl}}",
      "TOWER_OAUTH_TOKEN": "{{oauth_token}}",
      "CONTROLLER_HOST": "{{host}}",
      "CONTROLLER_USERNAME": "{{username}}",
      "CONTROLLER_PASSWORD": "{{password}}",
      "CONTROLLER_VERIFY_SSL": "{{verify_ssl}}",
      "CONTROLLER_OAUTH_TOKEN": "{{oauth_token}}"
    }
  }
}
```

### 创建自定义类型

```bash
awx credential_types create
```

注意

- 仅超级用户可创建/修改凭证类型
- 系统内置类型为只读
- 正在使用的凭证类型其输入模式不可修改

## 凭证管理

创建凭证实例

```bash
awx credentials create
```

安全特性：

- 标记为`secret`的字段会自动加密存储
- API 返回的加密字段显示为`$encrypted$`

关联凭证

```bash
awx job_templates associate
```

作业模板可关联多个不同类型的凭证

约束条件：

- 同类型凭证不能重复关联
- 支持运行时凭证指定（当 `ask_credential_on_launch=true`时）
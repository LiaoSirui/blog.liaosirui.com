## `ansible-creator`

文档：<https://readthedocs.ansible.org.cn/projects/creator/installing/>

`init collection` 命令初始化 Ansible 集合项目

```bash
ansible-creator init collection <collection-name> <path>

# ansible-creator init collection testns.testname $HOME/collections/ansible_collections
# 此命令将在 $HOME/collections/ansible_collections/testns/testname 中搭建 testns.testname 集合
```

`init playbook` 命令初始化 Ansible playbook 项目

```bash
ansible-creator init playbook <collection-name> <path>
```

`add` 子命令允许用户将资源和插件等内容类型搭建到现有项目中

```bash
ansible-creator add resource <resource-type> <path>

# ansible-creator add resource xx-role roles
```

## `ansible-galaxy`

### 创建 Ansible Collection 项目

通过 `ansible-galaxy collection init` 创建集合项目，适合复杂或需要共享的任务

```bash
ansible-galaxy collection init demonamespace.demo
```

生成的目录结构

```bash
# tree demonamespace
demonamespace
└── demo
    ├── docs             # 文档目录
    ├── galaxy.yml       # 集合定义文件
    ├── meta             # 元数据
    │   └── runtime.yml
    ├── plugins          # 插件目录
    │   └── README.md
    ├── README.md        # 项目说明
    └── roles            # 角色目录
```

创建一个 Playbook 调用集合角色：

```yaml
mkdir playbooks
cat > playbooks/setup.yml << EOF
- name: Run a role from collection
  hosts: all
  roles:
    - demonamespace.demo.my_role
EOF
```

运行 Playbook

```bash
ansible-playbook -i inventory/hosts playbooks/setup.yml
```

### 创建 Ansible Role 项目

通过 `ansible-galaxy init` 创建角色项目，适合简单或单一自动化任务的组织

```bash
ansible-galaxy init ansible-demo
```

生成的目录结构：

```bash
# tree ansible-demo
ansible-demo
├── defaults       # 默认变量
│   └── main.yml
├── files          # 静态文件
├── handlers       # 任务处理器
│   └── main.yml
├── meta           # 元数据
│   └── main.yml
├── README.md      # 项目说明
├── tasks          # 任务逻辑
│   └── main.yml
├── templates      # 模板文件
├── tests          # 测试任务
│   ├── inventory
│   └── test.yml
└── vars           # 变量文件
    └── main.yml
```

角色没有明确的入口，通常需要通过 Playbook 调用。例如：

创建 Playbook 文件：

```bash
mkdir playbooks
cat > playbooks/setup.yml << EOF
- name: Run ansible-demo role
  hosts: all
  roles:
    - ansible-demo
EOF
```

运行 Roles：

```bash
ansible-playbook -i inventory/hosts playbooks/setup.yml
```


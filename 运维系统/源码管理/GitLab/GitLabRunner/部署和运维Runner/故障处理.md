## Failed to assign job to the runner

出现报错

```bash
The scheduler failed to assign job to the runner, please try again or contact system administrator
```

依次排查日志找到

```bash
    "exception.class": "RuntimeError",
    "exception.message": "CI job token signing key is not set",
```

查看下 ci_job_token_signing_key

```bash
root@b2df6df4d364:/# gitlab-rails console
--------------------------------------------------------------------------------
 Ruby:         ruby 3.2.8 (2025-03-26 revision 13f495dc2c) [x86_64-linux]
 GitLab:       18.5.1-ee (a01b2eeb76d) EE
 GitLab Shell: 14.45.3
 PostgreSQL:   16.9
------------------------------------------------------------[ booted in 54.12s ]
Loading production environment (Rails 7.1.5.2)
irb(main):001> Gitlab::CurrentSettings.ci_job_token_signing_key.present?
=> false
irb(main):002> ApplicationSetting.last.valid?
=> true
```

查看 DB Migrate

```bash
root@b2df6df4d364:/# gitlab-rake db:migrate:status |grep 20241017160504 
   up     20241017160504  regular  17.7         GenerateCiJobTokenSigningKey
```

重新启动这个 Migrate

```bash
gitlab-rails db:migrate:down VERSION=20241017160504
gitlab-rails db:migrate:up VERSION=20241017160504
gitlab-ctl restart
```

### Services: FATAL: No HOST or PORT found

<https://support.gitlab.com/hc/en-us/articles/23955096198812-GitLab-Runner-Services-Fail-to-Start-with-Docker-29-x-x-No-HOST-or-PORT-found-Error>

Add the following environment variable to your Docker service  configuration to re-enable the deprecated legacy links functionality:

```bash
Environment="DOCKER_KEEP_DEPRECATED_LEGACY_LINKS_ENV_VARS=1"
```

